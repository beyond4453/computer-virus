#include <windows.h>

#pragma comment(lib, "user32.lib")

char code[] = {
0x55,						//push ebp
0x8B, 0xEC,					//mov ebp, esp

0x83, 0xEC, 0x40,			//sub esp,40
0xC6, 0x45, 0xC0, 0x75,		
0xC6, 0x45, 0xC1, 0x73,
0xC6, 0x45, 0xC2, 0x65,		
0xC6, 0x45, 0xC3, 0x72,
0xC6, 0x45, 0xC4, 0x33,		
0xC6, 0x45, 0xC5, 0x32,
0xC6, 0x45, 0xC6, 0x2E,		
0xC6, 0x45, 0xC7, 0x64,
0xC6, 0x45, 0xC8, 0x6C,		
0xC6, 0x45, 0xC9, 0x6C,
0xC6, 0x45, 0xCA, 0x00,		
0x8D, 0x5D, 0xC0,				//lea ebx, dword ptr[ebp-40]
0x53,							//push ebx
0xB8, 0x55, 0xDC, 0xD7, 0x76,	//mov eax, LoadLibraryA
0xFF, 0xD0,						//call eax

0xC6, 0x45, 0xD0, 0x4D,		
0xC6, 0x45, 0xD1, 0x65,
0xC6, 0x45, 0xD2, 0x73,		
0xC6, 0x45, 0xD3, 0x73,
0xC6, 0x45, 0xD4, 0x61,		
0xC6, 0x45, 0xD5, 0x67,
0xC6, 0x45, 0xD6, 0x65,		
0xC6, 0x45, 0xD7, 0x42,
0xC6, 0x45, 0xD8, 0x6F,		
0xC6, 0x45, 0xD9, 0x78,
0xC6, 0x45, 0xDA, 0x41,	
0xC6, 0x45, 0xDB, 0x00,
0x8D, 0x5D, 0xD0,				//lea ebx, dword ptr[ebp-30]
0x53,							//push ebx
0x50,							//push eax
0xB8, 0x84, 0xCC, 0xD7, 0x76,	//mov eax, dword ptr[GetProcAddress]
0xFF, 0xD0,						//call eax


0xC6, 0x45, 0xE0, 0x49,		
0xC6, 0x45, 0xE1, 0x27,
0xC6, 0x45, 0xE2, 0x6D,		
0xC6, 0x45, 0xE3, 0x20,
0xC6, 0x45, 0xE4, 0x68,		
0xC6, 0x45, 0xE5, 0x61,
0xC6, 0x45, 0xE6, 0x63,		
0xC6, 0x45, 0xE7, 0x6B,
0xC6, 0x45, 0xE8, 0x65,		
0xC6, 0x45, 0xE9, 0x64,
0xC6, 0x45, 0xEA, 0x00,	

0x8D, 0x5D, 0xE0,			//lea ebx, dword ptr[ebp-20]
0x6A, 0x00,					//push 0
0x53,						//push ebx
0x53,						//push ebx
0x6A, 0x00,					//push 0
0xFF, 0xD0,					//call eax
0x83, 0xC4, 0x40,			//add esp, 40

0x8B, 0xE5,					//mov esp, ebp
0x5D,						//pop ebp
0xC3						//ret
};
void main()
{
    int op;
//	MessageBoxA(0,"","",0);
    VirtualProtect(&code[0], sizeof(code), PAGE_EXECUTE_READWRITE, &op);
    __asm {
       call offset code
    }
} 